# Mrs. GREEN APPLE 星座マップ - 動的星座

## コンセプト

全楽曲をリリース日順のグリッドに配置し、**カテゴリを選択すると星座が浮かび上がる**インタラクティブな星座マップ。

```
通常時: 全ての星が白く均一に輝いている（リリース日順にグリッド配置）
    ↓
カテゴリ選択（例: "ANTENNA"）
    ↓
該当曲がハイライト + 収録順/セトリ順に星座線（カテゴリ固有色）で結ばれる
    ↓
複数選択で星座を比較（異なる色の線で同時表示）
```

### 決定事項

1. **星の配置**: リリース日順で正方形グリッドに配置
2. **星の色**: 全て白で統一、星座線のみカテゴリ固有色
3. **星座線の結び方**: アルバム→収録順、ライブ→セットリスト順
4. **複数選択**: 対応。2つ以上の星座を同時に表示して比較可能

---

## 主要機能

### 1. カテゴリ選択で星座が出現

| カテゴリ | 星座線の結び方 | 例 |
|----------|---------------|-----|
| ライブ/ツアー | セットリスト順 | DOME TOUR "BABEL no TOH" |
| アルバム | 収録順 | ANTENNA, Attitude |
| シングル | 表題曲 → カップリング順 | ケセラセラ |

### 2. 複数選択で比較

```
[ANTENNA ×] [Attitude ×]

→ 2つの星座が異なる色の線で同時表示
→ 共通曲（両方に含まれる）は複数の線が集まる
```

### 3. 星の配置（グリッドレイアウト）

```
  2014              2025
  ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
  │★│★│★│★│★│★│★│★│★│★│★│ ← 古い曲
  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
  │★│★│★│★│★│★│★│★│★│★│★│
  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
  │★│★│★│★│★│★│★│★│★│★│★│
  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
  │★│★│★│★│★│★│★│★│★│★│★│
  ...
  └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘ ← 新しい曲
```

- リリース日が古い順に左上から右へ配置
- 正方形グリッド（11×11程度）で均等配置
- 全ての星が同じサイズ・明るさ

---

## データ構造

### 楽曲データ (`songs.json`)

```json
{
  "id": "keserasera",
  "title": "ケセラセラ",
  "releaseDate": "2023-04-25",
  "year": 2023
}
```

### 星座定義 (`constellations.json`)

```json
[
  {
    "id": "babel-no-toh-2025",
    "name": "DOME TOUR 2025 \"BABEL no TOH\"",
    "type": "live",
    "year": 2025,
    "date": "2025-02-22",
    "color": "#f472b6",
    "songs": ["ダンスホール", "ANTENNA", "ケセラセラ", "..."]
  },
  {
    "id": "antenna",
    "name": "ANTENNA",
    "type": "album",
    "year": 2023,
    "date": "2023-07-05",
    "color": "#4ade80",
    "songs": ["ANTENNA", "Magic", "Blizzard", "..."]
  }
]
```

### 星の位置 (`positions.json`)

```json
[
  {
    "id": "keserasera",
    "x": 23.5,
    "y": 31.2
  }
]
```

---

## UI 設計

### レイアウト

```
┌─────────────────────────────────────────────────────────┐
│                                                   [MAP] │ ← ミニマップ（右上）
│                                                         │
│    [星空エリア - ドラッグで移動、ピンチでズーム]         │
│                                                         │
│                     ┌──────────────┐                    │
│                     │ ★ 曲名       │ ← 詳細カード      │
│                     │ 2023.04.25   │   (スワイプで移動)│
│                     │ ◀          ▶ │                    │
│                     └──────────────┘                    │
├─────────────────────────────────────────────────────────┤
│  カテゴリ選択                                           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                   │
│  │ライブ ▼│ │アルバム▼│ │シングル▼│                   │
│  └─────────┘ └─────────┘ └─────────┘                   │
│                                                         │
│  選択中: [ANTENNA ×] [BABEL no TOH ×]                  │
└─────────────────────────────────────────────────────────┘
```

### ミニマップ

```
┌────────┐
│ ┌──┐   │ ← 現在のビューポート（白枠）
│ │  │   │
│ └──┘   │
│        │
└────────┘
```

- 右上に固定表示
- 全体のどこを見ているか表示
- ビューポートは白枠で表示

### 詳細カード（星タップ時）

```
┌─────────────────────────┐
│  ★ ケセラセラ           │
│  2023.04.25             │
│                         │
│  収録:                  │
│  • ANTENNA (5thアルバム)│
│                         │
│  ライブ:                │
│  • DOME TOUR 2025       │
│  • Zepp Tour 2023       │
│                         │
│  [YouTube] [Spotify]    │
└─────────────────────────┘
```

---

## インタラクション

### ビューの操作

- **ドラッグ**: パン移動
- **ピンチ/ホイール**: ズーム（0.5x〜2.0x、グリッド全体が収まるまで縮小可能）
- **ダブルタップ**: 初期位置・ズームにリセット

### 星座の表示

1. カテゴリドロップダウンを開く
2. 項目を選択（例: "ANTENNA"）
3. 該当曲がハイライト（他は暗く）
4. 収録順/セトリ順に星座線がアニメーションで描画
5. 選択タグが下部に追加される

### カードナビゲーション（GoogleMaps風）

1. 星をタップ → 詳細カードが表示
2. カードを**左スワイプ** → 次の曲へ移動、ビューがその星を中心に
3. カードを**右スワイプ** → 前の曲へ移動、ビューがその星を中心に

**ナビゲーション順序**:
- 星座未選択時: リリース日順（古い→新しい）
- 星座選択時: その星座の収録順/セトリ順

### 複数選択

- 複数のカテゴリを同時に選択可能
- 各星座は異なる色の線で表示
- 選択タグの「×」で個別解除

---

## スクリプト構成

```
scripts/
├── 01-fetch-songs.ts          # 楽曲基本情報を生成
├── 02-build-constellations.ts # 星座データを構築
├── 04-calculate-positions.ts  # グリッド位置を計算
├── 05-export-to-site.ts       # サイトへエクスポート
├── types.ts                   # 共通型定義
└── data/
    ├── albums-data.ts         # アルバム・シングル定義
    └── lives-data.ts          # ライブ・セットリスト定義
```

---

## 位置計算アルゴリズム

`04-calculate-positions.ts` はリリース日順で正方形グリッドに配置：

```typescript
const sortedSongs = songs.sort((a, b) =>
  new Date(a.releaseDate).getTime() - new Date(b.releaseDate).getTime()
);

const cols = Math.ceil(Math.sqrt(total));  // 例: 121曲 → 11列
const rows = Math.ceil(total / cols);       // 11行

positions = sortedSongs.map((song, index) => ({
  id: song.id,
  x: padding + cellWidth * (index % cols + 0.5),
  y: padding + cellHeight * (Math.floor(index / cols) + 0.5),
}));
```

---

## 主要ライブ（収録対象）

| 年 | ライブ名 |
|----|----------|
| 2025 | DOME TOUR "BABEL no TOH" |
| 2024 | The White Lounge |
| 2024 | ARENA TOUR "NOAH no HAKOBUNE" |
| 2023 | Zepp Tour "ゼンジン未到とリライアンス" |
| 2022 | ARENA SHOW "Utopia" |
| 2019 | アリーナツアー "エデンの園" |
| 2019 | HALL TOUR "The ROOM TOUR" |

---

## 残タスク・改善案

→ **[TODO.md](./TODO.md)** を参照
