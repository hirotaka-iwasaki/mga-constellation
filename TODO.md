# TODO - Mrs. GREEN APPLE 動的星座マップ

> **Note**: `[公開]` タグ付きの項目は roadmap ページに表示されます

## 完了済み

- [x] Astro + Preact プロジェクト作成
- [x] 星空コンポーネント実装（星の表示）
- [x] カテゴリ選択UI（ライブ/アルバム/シングル）
- [x] 星座線の描画（選択したカテゴリの曲を順に線で結ぶ）
- [x] ハイライト機能（選択時に該当曲を明るく、非選択を暗く）
- [x] 複数選択対応（異なる色の線で同時表示）
- [x] 選択中タグ表示（×で個別解除）
- [x] パン・ズーム操作（ドラッグ、ピンチ、ホイール）
- [x] 詳細カード（星タップ時）
- [x] カードスワイプナビゲーション（GoogleMaps風）
- [x] 星座選択時のナビゲーション順序切り替え
- [x] モバイルファースト対応（タッチUI）
- [x] グリッドレイアウト（リリース日順配置）
- [x] 星の統一表示（全て白・同サイズ）
- [x] OGP/メタタグ設定
- [x] Cloudflare Pages デプロイ (https://mga-constellation.pages.dev/)
- [x] favicon.svg作成
- [x] ローディング表示（スピナー＆フェードイン演出）
- [x] 星座線の描画アニメーション（点が順番に現れる演出）
- [x] 曲検索機能（曲名で検索し、特定の星へジャンプ）
- [x] 外部リンク追加（YouTube/Spotify/Apple Musicへの検索リンク）
- [x] キーボード操作（矢印キーでナビゲーション、/で検索、Escで選択解除）
- [x] 凡例表示（複数星座選択時に線の色とアルバム/ライブ名の対応を表示）
- [x] カスタム星座作成（自分の好きな曲を選んでオリジナル星座を作成）
- [x] 星座画像化(Canvasで星座を画像出力、Web Share APIで共有)
- [x] チュートリアル(ボタンタップで操作ガイドをオーバーレイ表示)
- [x] ウェルカムモーダル（初回アクセス時にコンセプト説明）
- [x] 詳細カード強化（曲が収録されているアルバム/ライブ一覧を表示）
- [x] シングルカテゴリ削除（すべてアルバムに収録されているため不要）
- [x] ベストアルバム「10」追加（2025年7月8日リリース）
- [x] 選択中タグをフッター上部に移動（視認性向上）
- [x] 星座選択時のUX改善（選択後メニューを閉じ1曲目を表示）
- [x] ロードマップページ(今後のリリース予定や検討中の機能を公開するページを追加)
- [x] フィードバックフォーム（要望受付フォームをサイト内に設置）
- [x] 星座名前付け機能（カスタム星座にオリジナル名を付与）

---

## 優先度: 高（UX向上・コンテンツ拡充）

### UI/UX 改善
- [ ] **カードにジャケット表示** `[公開:表示]` - アルバムアートを表示（Page Speed Insights要検証）
- [ ] **タッチターゲット最適化** - 星のタップ領域を最小44×44pxに、間隔8px以上確保
- [ ] **2本指ジェスチャープロンプト** - 1本指パン時に「2本指で空を移動」と控えめに表示

### 検索・ナビゲーション
- [ ] **ランダムジャンプ** `[公開:探索]` - 「今日のラッキースター」ボタンでランダムな曲へ案内
- [ ] **曲名ラベル表示トグル** `[公開:表示]` - ズームレベルに応じてラベル表示/非表示を切り替え

### 共有機能の強化
- [ ] **URL状態の効率化** `[公開:共有]` - 曲選択をビット配列でエンコード（121曲≈20文字のBase64）
- [ ] **推奨ハッシュタグ表示** `[公開:共有]` - 共有時に `#ミセス推し座` を提案

### コンテンツ拡充
- [ ] **フェーズの切り替わり** `[公開:表示]` - フェーズ1,2の楽曲を分類

---

## 優先度: 中（機能追加・運用改善）

### 開発・運用
- [ ] **新曲追加スクリプト** - 対話式CLIで01-fetch-songs.tsへ楽曲追加
- [ ] **新アルバム追加スクリプト** - 対話式CLIでalbums-data.tsへアルバム追加
- [ ] **新ライブ追加スクリプト** - 対話式CLIでlives-data.tsへライブ追加
- [ ] **PWA対応** `[公開:便利]` - manifest.json追加でホーム画面に追加可能に

### カード・コンテキストリンク
- [ ] **初披露ライブへのリンク** `[公開:探索]` - カードから「この曲が初めて演奏されたライブ」へジャンプ

### カスタム星座の強化
- [ ] **診断・称号機能** `[公開:共有]` - 選んだ曲傾向から「Pop星雲型」などの称号を付与

### マイクロインタラクション
- [ ] **星の脈動アニメーション** `[公開:表示]` - ホバー/タップ時にゆっくり脈動
- [ ] **未訪問の星の瞬き** - 微妙なランダムな瞬きで探索を促す

### エンゲージメント機能
- [ ] **探索率カウンター** `[公開:探索]` - 控えめな「空の○○%を探索済み」表示
- [ ] **日付ベースのイースターエッグ** `[公開:探索]` - アルバム記念日/メンバー誕生日に特別な星座を表示
- [ ] **星座コンプリートバッジ** `[公開:共有]` - アルバム全曲探索で達成カードを付与、共有可能

### アクセシビリティ
- [ ] **アクセシビリティ強化** - aria-label, フォーカス管理, スクリーンリーダー対応

---

## 優先度: 低（将来検討）

### 視覚演出
- [ ] **流れ星エフェクト** `[公開:表示]` - 一定時間操作がないと流れ星が流れる演出
- [ ] **カーソル追従エフェクト** - PC向け、マウスに追従する微妙な光の軌跡
- [ ] **星の形状による区別** - アルバム曲は丸、シングル曲は星型、ライブ限定曲は菱形など
- [ ] **星の明るさマッピング** - 新曲は明るく「若い星」、初期曲は安定した光点に
- [ ] **ジャイロスコープパララックス** - モバイルで傾けると星空が微妙にシフト（prefers-reduced-motion対応）
- [ ] **背景カラー演出** `[公開:表示]` - 選択中のアルバムのテーマカラーを背景に微妙に反映

### 複数星座の比較機能
- [ ] **共通曲ハイライト** `[公開:探索]` - 複数星座で共有される曲を二重輪郭・点滅で強調
- [ ] **比較モード切替** - 各星座の表示/非表示を個別トグルで切り替え
- [ ] **線の順次アニメ表示** - 複数星座選択時に線を1つずつ順番にアニメーション描画

### ガイド・ストーリーテリング
- [ ] **星座ガイドモード** `[公開:探索]` - 「○○年当時のセットリストを辿ろう」と順に星が光って案内
- [ ] **スクロールテリング** - スクロールに合わせて星座が点灯し解説が表示される縦長ページ
- [ ] **楽曲の世界観** - 解説や世界観ごとの楽曲の関連付け

### 隠し要素・達成報酬
- [ ] **全曲制覇スペシャル星座** `[公開:探索]` - 全121曲を訪問したファン限定の隠し星座出現
- [ ] **限定壁紙ダウンロード** - 特定条件達成で壁紙をダウンロード可能に
- [ ] **ディスカバリートレイル** - 訪問した曲を結ぶ「彗星の軌跡」、セッション終了時に共有可能

### パフォーマンス最適化
- [ ] **同時アニメーション制限** - 15-20要素以下に制限、will-changeは控えめに
- [ ] **フルスクリーンモード** - requestFullscreen()でブラウザUIを非表示に（iOS Safari用CSS対応）

### テーマ・表示モード
- [ ] **カラーテーマ切替** `[公開:表示]` - 昼/夜モード、GREEN APPLEモード（緑基調）など
- [ ] **多言語対応** `[公開:便利]` - UIテキストを英語表示に切り替え可能（海外ファン向け）

### 長押し・インタラクション
- [ ] **長押しクイックアクション** - 星の長押しでプレビュー再生/お気に入り追加メニュー

### ゲーム・エンゲージメント
- [ ] **星座クイズ** `[公開:探索]` - 星座線だけ表示し、どのアルバム/ライブか当てるゲーム
- [ ] **推し星座ギャラリー** - ユーザー投稿のカスタム星座を一覧表示（要バックエンド）

### オンボーディング
- [ ] **シェアURL用ガイド** - URLパラメータ経由のアクセス時に「ドラッグで探索できます」等表示

### デプロイ
- [ ] **カスタムドメイン** - 必要に応じて設定
- [ ] **アナリティクス** - Cloudflare Web Analytics または Google Analytics
- [ ] **リポジトリ整理** - デプロイ前に初回のみ実行スクリプト等の不要ファイルを削除

---

## 要検証・大規模改修（後回し）

- [ ] **Canvas描画への移行** - 星空本体をCanvasで描画し低スペック端末でも60fps確保
- [ ] **動的OGP画像生成** `[公開:共有]` - 選択した星座のプレビュー画像を動的生成
- [ ] **歌詞取得・保持** - Uta-Net等から手動取得、ローカルJSON保存（.gitignore）
- [ ] **歌詞一文表示** - カードに印象的な一文を表示（歌詞データ必須）

### オーディオ連携
- [ ] **オーディオプレビュー** `[公開:探索]` - 星選択時に30秒プレビュー（Spotify埋め込み等）
- [ ] **音声波形可視化** - 再生中の星の周りに微妙なコロナとして表示

### 外部連携
- [ ] **Spotify連携** `[公開:便利]` - 再生履歴に基づき、よく聴く曲の星を強調表示
- [ ] **Apple Music連携** `[公開:便利]` - MusicKit JSでライブラリ連携

### AR・没入体験
- [ ] **AR星空モード** `[公開:探索]` - WebXR/AR.jsでカメラ越しに星空を重ねて表示（アプリ不要）

### リアルタイム・ソーシャル機能
- [ ] **リアルタイム同期視聴** - WebSocket/SSEで複数人が同じ星座を同時に見る機能
- [ ] **投稿数/いいねランキング** - 人気のカスタム星座をランキング表示（要バックエンド）

---

## 参考事例リンク

- Music Galaxy (Spotify非公式3D音楽宇宙): https://galaxy.spotify.com
- Scaled in Miles (Miles Davisディスコグラフィ): https://scaledinmiles.com
- Music-Map (アーティスト類似度マップ): https://www.music-map.com
- Instafest (Spotifyデータからフェスポスター生成): https://instafest.app

---

## 技術メモ

### カスタム星座作成 & 画像化
- **星選択UI**: 既存の星タップ処理を拡張、選択モード時は星座線を動的に描画
- **画像化**: [html-to-image](https://www.npmjs.com/package/html-to-image) または html2canvas でSVG→PNG変換
- **共有**: [Web Share API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Share_API)（モバイル67%対応）でネイティブ共有、非対応時はダウンロードボタン

### 歌詞機能
- **取得元候補**: [Uta-Net](https://www.uta-net.com/)（30万曲以上の邦楽歌詞）、手動コピー推奨
- **保存形式**: `scripts/data/lyrics.json`（.gitignore推奨）
- **著作権**: 歌詞の無断転載は禁止。個人利用の範囲で、表示は一文のみに限定

### ジャケット表示
- **画像最適化**: WebP形式、適切なサイズ（150x150程度）で影響を最小化
- **遅延読み込み**: `loading="lazy"` で初期表示を軽量に
- **検証**: 実装後にPage Speed Insightsでスコア確認、悪化なら無効化
